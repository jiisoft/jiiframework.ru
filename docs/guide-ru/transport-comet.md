Комет
=======

Для начала немного справки о том, что такое комет ([wiki](https://ru.wikipedia.org/wiki/Comet_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5))):

> Comet (в веб-разработке) — любая модель работы веб-приложения, при которой постоянное HTTP-соединение позволяет
> веб-серверу отправлять (push) данные браузеру без дополнительного запроса со стороны браузера. Общая черта таких
> моделей состоит в том, что все они основаны на технологиях, непосредственно поддерживаемых браузером
> (напр., JavaScript), а не на проприетарных плагинах. Теоретически модель Comet отличается от изначальной концепции
> всемирной паутины, при которой для обновления страницы браузер запрашивает её полностью или частично. Однако на
> практике приложения Comet обычно используют Ajax c long polling для проверки наличия новой информации на сервере.

Jii-comet - это масштабируемый, готовый к высоким нагрузкам и плохому интернету транспорт, реализующий постоянную связь
между клиентом и сервером для мгновенного обмена данными.

Jii-comet предоставляет набор компонентов и классов, которые содержат набор методов и свойств для упрощения обмена
сообщениями между каналами, подписки на них, обмена данными между серверами и так далее. Сам модуль не умеет доставлять
сообщения на клиент и обратно, но в нем заложена абстракция, чтобы это можно было делать любой из существующих
популярных библиотек (например, socket.io, sockjs), а так же чтобы это было надежно и масштибаруемо.

## Конфигурация

Комет устанавливается как [компонент приложения](structure-application-components), на сервере и клиенте соответственно.
На сервере комет открывает и "слушает" данные из указанного порта, а клиент при инициализации приложения подключается
к этому порту и ждет информацию.

## Конфигурация и масштабирование сервера

Jii-comet предоставляет два класса для создания сервера:
- `Jii.comet.server.HubServer` - сервер, настроенный только для прослушивания сообщений от соединений, при этом самих
подключений у него нет, но он может отправить данные в подключение, находящееся в соседнем процессе. Т.е. в такой сервер
напрямую (на порт) невозможно подключиться, однако сообщение можно отправить через другие процессы (к которым подключены
клиенты).
- `Jii.comet.server.Server` - полноценный сервер, унаследован он предыдущего. Хранит и поддерживает прямое соединение
с клиентами, может обмениваться данными с клиентом.

Такое резделение необходимо для гибкого масштабирования приложения. Например, вы можете создать несколько процессов
с компонентом `Jii.comet.server.Server`, которые будут только поддерживать соединение с клиентами, но не обрабатывать
бизнес логику. И создать несколько процессов `Jii.comet.server.HubServer`, которые будут выполнять тяжелые вычесления.
Это позволит сделать комет-канал более отзывчивым: если бы все операции были бы на одном сервере, то сложные операции
затормаживали бы процесс, и все последующие запросы (даже легкие) были бы с задержкой.

Если у вас нет больших нагрузок или вы не знаете что выбрать, выбирайте компонент `Jii.comet.server.Server`, так как он
содержит в себе весь функционал.

Пример конфигурации для сервера выглядит так:

```js
application: {
    components: {
        comet: {
            className: 'Jii.comet.server.Server',
            host: '0.0.0.0',
            port: 3100,
            transport: {
                className: 'Jii.comet.server.transport.Sockjs'
            }
        },
        
        // ...
    }
}
```

## Конфигурация клиента

На клиенте немного проще: есть один компонент `Jii.comet.client.Client`, который подключается к одному из серверов и
обменивается данными.




```js
application: {
    components: {
        comet: {
            className: 'Jii.comet.client.Client',
            serverUrl: 'http://localhost:4401/comet',
            autoOpen: true,
            transport: {
                className: 'Jii.comet.client.transport.Sockjs'
            },
            plugins: {
                autoReconnect: {
                    className: 'Jii.comet.client.plugin.AutoReconnect'
                }
            }
        },
        
        // ...
    }
}
```

## Внутренний канал связи

Jii имеет абстракцию, позволяющую использовать любую библиотеку в качестве внутреннего канала связи между клиентом и
сервером. На данный момент сделан адаптер для библиотеки [sockjs](https://github.com/sockjs/sockjs-client),
в будущем появится и для [socket.io](http://socket.io/).

В конфигурации транспорт объявляется в секции `transport`:

```js
comet: {
    className: 'Jii.comet.client.Client',
    transport: {
        className: 'Jii.comet.client.transport.Sockjs', // default
        // transport config params..
    }
}
```

## Плагины

